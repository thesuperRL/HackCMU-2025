<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Add Bootstrap Icons CSS -->
  <!-- Add Bootstrap Icons CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
  <title>HackCMU 2025</title>
  <link rel="stylesheet" href="../static/css/style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <svg class="logo" viewBox="0 0 24 24" aria-hidden="true">
          <path
            d="M12 2c-2.5 0-4.5 2-4.5 4.5S12 14 12 14s4.5-5 4.5-7.5S14.5 2 12 2zm0 0c-3 0-5.5 2.5-5.5 5.5S9 13 12 13s5.5-2.5 5.5-5.5S15 2 12 2z"
            fill="currentColor" />
        </svg>

        <span class="title">LanternFly Quest</span>
        <span class="pill">alpha</span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/info">About</a>
        <a href="/learn">Learn</a>
        <a href="/report">Report</a>
        <a href="/leaderboard">Leaderboard</a>
      </nav>
      <!-- in the header, replace the whole .auth div with this -->
      <div class="auth">
        <!-- Google Identity config (keeps One Tap off) -->
        <div id="g_id_onload" data-auto_prompt="false" data-callback="handleCredentialResponse"
          data-client_id="598997653463-svi76fvbe15v910t9c91eulju4vqasaa.apps.googleusercontent.com">
        </div>

        <!-- Account dropdown -->
        <div class="account">
          <button id="accountBtn" class="account-btn" aria-haspopup="true" aria-expanded="false"
            aria-controls="accountMenu" title="Account">
            <i class="bi bi-person-circle"></i>
          </button>

          <div id="accountMenu" class="account-menu" role="menu" aria-hidden="true">
            <!-- Google Sign-In button lives inside the dropdown -->
            <div class="g_id_signin" data-theme="filled_blue" data-size="large" data-shape="pill"
              data-text="signin_with" data-logo_alignment="left">
            </div>

            <!-- Optional: a manual sign-out or profile area you toggle when logged in -->
            <div class="signed-in hidden" id="signedInPanel">
              <div class="profile-row">
                <img id="avatar" alt="" />
                <div class="who">
                  <strong id="whoami">Signed in</strong>
                  <div id="email" class="muted"></div>
                </div>
              </div>
              <button id="logoutBtn" class="btn secondary" type="button">Log out</button>
            </div>
          </div>
        </div>
      </div>

    </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container hero-inner">
        <div>
          <h1>Turn invasive pests into points.</h1>
          <p class="lead">Track, verify, and <strong>gamify</strong> the removal of spotted lanternflies. Log catches,
            compete on the leaderboard, and earn badges for real-world impact.</p>
          <a href="#report" class="btn cta">Start Reporting</a>
        </div>
        <!-- Updated hero-card with icons -->
        <div class="hero-card" aria-hidden="true">
          <div class="card stat">
            <i class="bi bi-trophy"></i>
            <span class="stat-label">Total Points</span>
            <span id="statTotalPoints" class="stat-value">0</span>
          </div>
          <div class="card stat">
            <i class="bi bi-fire"></i>
            <span class="stat-label">Your Streak</span>
            <span id="statStreak" class="stat-value">0</span>
          </div>
          <div class="card stat">
            <i class="bi bi-bug"></i>
            <span class="stat-label">Your Catches</span>
            <span id="statCatches" class="stat-value">0</span>
          </div>
        </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <span>LanternFly Quest Â· v0.1</span>
      <button id="resetDemo" class="btn danger small" title="Reset demo data">Reset</button>
    </div>
  </footer>

  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Google Authentication Script -->
  <script src="https://accounts.google.com/gsi/client" async></script>
  <script src="static/js/main.js"></script>

  <script>
    // Dropdown open/close
    (function () {
      const btn = document.getElementById('accountBtn');
      const menu = document.getElementById('accountMenu');

      function openMenu() { menu.classList.add('open'); btn.setAttribute('aria-expanded', 'true'); menu.setAttribute('aria-hidden', 'false'); }
      function closeMenu() { menu.classList.remove('open'); btn.setAttribute('aria-expanded', 'false'); menu.setAttribute('aria-hidden', 'true'); }

      btn.addEventListener('click', (e) => { e.stopPropagation(); menu.classList.contains('open') ? closeMenu() : openMenu(); });
      document.addEventListener('click', (e) => { if (!menu.contains(e.target) && e.target !== btn) closeMenu(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
    })();

    // Hook into your existing Google callback to populate the profile area
    function decodeJWT(token) {
      const base64Url = token.split(".")[1];
      const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
      const jsonPayload = decodeURIComponent(atob(base64).split("")
        .map(c => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2)).join(""));
      return JSON.parse(jsonPayload);
    }

    window.handleCredentialResponse = function (response) {
      const p = decodeJWT(response.credential);
      // Update simple UI
      const signedPanel = document.getElementById('signedInPanel');
      const who = document.getElementById('whoami');
      const email = document.getElementById('email');
      const avatar = document.getElementById('avatar');

      if (who) who.textContent = p.name || 'Signed in';
      if (email) email.textContent = p.email || '';
      if (avatar) avatar.src = p.picture || '';

      if (signedPanel) {
        signedPanel.classList.remove('hidden');
      }
      // (Optional) hide the Google button after sign-in
      const gid = document.querySelector('.g_id_signin');
      if (gid) gid.style.display = 'none';

      // TODO: your auth state/store goes here
      console.log('Signed in:', p);
    };

    // Optional: basic "Log out" (client-side only; you may do server/session logic)
    (function () {
      const logout = document.getElementById('logoutBtn');
      if (!logout) return;
      logout.addEventListener('click', () => {
        // Clear UI
        const signedPanel = document.getElementById('signedInPanel');
        if (signedPanel) signedPanel.classList.add('hidden');
        const gid = document.querySelector('.g_id_signin');
        if (gid) gid.style.display = 'inline-block';
        console.log('Logged out (client-side). Implement real sign-out as needed.');
      });
    })();
  </script>

</body>

</html>