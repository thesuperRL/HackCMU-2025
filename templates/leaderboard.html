<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>LanternFly Quest — Leaderboard</title>

    <!-- Icons + App CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />

    <!-- Point to Flask static dir -->
    <link rel="stylesheet" href="../static/css/style.css" />

    <style>
      /* Page-specific tweaks (keeps your site CSS intact) */
      .page-header {
        padding: 32px 0 12px;
      }
      .toolbar {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }
      .toolbar .input {
        flex: 1;
        min-width: 220px;
      }
      .input input {
        width: 100%;
        background: var(--bg-elev);
        color: var(--fg);
        border: 1px solid rgba(148, 163, 184, 0.22);
        border-radius: 10px;
        padding: 0.65rem 0.8rem;
      }
      .input input:focus {
        border-color: transparent;
        box-shadow: 0 0 0 6px var(--ring);
        outline: none;
      }

      .board {
        margin-top: 16px;
        border-radius: var(--radius-xl);
        overflow: hidden;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      thead th {
        text-align: left;
        font-weight: 800;
        font-size: 0.95rem;
        color: var(--muted);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.07),
          rgba(255, 255, 255, 0.02)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        padding: 12px 14px;
        user-select: none;
        cursor: pointer;
      }
      tbody td {
        padding: 14px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }
      tbody tr:hover {
        background: rgba(255, 255, 255, 0.04);
      }
      .rank {
        font-weight: 800;
        width: 64px;
      }
      .user {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .avatar {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
      }
      .badge {
        font-size: 0.75rem;
        padding: 0.15rem 0.45rem;
        border-radius: 999px;
        background: rgba(125, 211, 252, 0.2);
        color: var(--fg);
      }
      .muted {
        color: var(--muted);
        font-size: 0.9rem;
      }
      .empty {
        text-align: center;
        padding: 40px;
        color: var(--muted);
        border: 1px dashed rgba(148, 163, 184, 0.35);
        border-radius: var(--radius-xl);
      }
      .sortable .arrow {
        opacity: 0.35;
        margin-left: 6px;
      }
      .sortable.active.asc .arrow {
        transform: rotate(180deg);
        opacity: 1;
      }
      .sortable.active.desc .arrow {
        opacity: 1;
      }

      /* Profile dropdown (consistent with other pages) */
      .auth { display:flex; align-items:center; gap:.5rem; }
      .profile { position: relative; margin-left: .25rem; }
      .icon-btn {
        display:inline-flex;align-items:center;justify-content:center;
        width:38px;height:38px;border-radius:999px;
        border:1px solid rgba(148,163,184,.22);
        background: var(--bg-elev, #0f152a); color: var(--fg, #eef2ff);
        cursor:pointer; transition: filter .15s ease, transform .08s ease;
      }
      .icon-btn:hover{ filter: brightness(1.1); }
      .icon-btn:active{ transform: translateY(1px); }
      .icon-btn img{ width:100%; height:100%; border-radius:999px; object-fit:cover; display:block; }
      .dropdown {
        position:absolute; right:0; top:calc(100% + 8px); z-index:1000;
        min-width:260px; background: var(--bg-elev,#0f152a); color: var(--fg,#eef2ff);
        border:1px solid rgba(148,163,184,.18); border-radius:12px;
        box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
        padding:8px;
      }
      .dropdown.hidden { display:none; }
      .dropdown-header{ padding:8px 10px 10px; border-bottom:1px solid rgba(148,163,184,.18); margin-bottom:8px; font-weight:700; }
      .dropdown-header small{ color: var(--muted,#9aa4c7); font-weight:600; }
      .dropdown-item{ display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; color:inherit; text-decoration:none; cursor:pointer; }
      .dropdown-item:hover{ background: rgba(255,255,255,.06); }
      .dropdown-item.btn-danger{ color:#fff; background: linear-gradient(180deg, var(--danger,#f87171), #b91c1c); }
      .rule { height:1px; background: rgba(148,163,184,.18); margin:8px 0; }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="/" aria-label="Home">
          <svg class="logo" viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M12 2c-2.5 0-4.5 2-4.5 4.5S12 14 12 14s4.5-5 4.5-7.5S14.5 2 12 2zm0 0c-3 0-5.5 2.5-5.5 5.5S9 13 12 13s5.5-2.5 5.5-5.5S15 2 12 2z"
              fill="currentColor"
            />
          </svg>
          <span class="title">LanternFly Quest</span>
          <span class="pill">alpha</span>
        </a>

        <nav class="nav">
          <a href="/">Home</a>
          <a href="/info">About</a>
          <a href="/learn">Learn</a>
          <a href="/report">Report</a>
          <a href="/leaderboard">Leaderboard</a>
        </nav>
        <div class="auth">
          <!-- Profile icon + dropdown with Google Sign-In inside -->
          <div class="profile">
            <button id="profileBtn" class="icon-btn" aria-haspopup="menu" aria-expanded="false" title="Account">
              <i class="bi bi-person-circle" aria-hidden="true"></i>
            </button>

            <div id="profileMenu" class="dropdown hidden" role="menu" aria-label="Account menu">
              <div class="dropdown-header">
                <div id="ddName">Guest</div>
                <small id="ddEmail">Not signed in</small>
              </div>

              <!-- Google Sign-In slot (rendered on first open) -->
              <div id="gisBlock" class="dropdown-item" style="justify-content:center;">
                <div id="gisBtn"></div>
              </div>

              <div class="rule"></div>

              <a class="dropdown-item" href="/profile"><i class="bi bi-person"></i> Profile</a>
              <a class="dropdown-item" href="/achievements"><i class="bi bi-award"></i> Achievements</a>

              <div class="rule"></div>
              <button id="logoutMenuBtn" class="dropdown-item btn-danger" type="button">
                <i class="bi bi-box-arrow-right"></i> Log out
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="page-header">
        <h1 style="margin: 0 0 0.35rem 0">Leaderboard</h1>
        <p class="muted">
          Live rankings for verified lanternfly kills. Updates automatically.
        </p>
      </section>

      <div class="toolbar">
        <div class="input">
          <input id="searchInput" type="text" placeholder="Search users…" />
        </div>
        <button id="refreshBtn" class="btn secondary">
          <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
        <button id="seedBtn" class="btn small">
          <i class="bi bi-beaker"></i> Seed Demo
        </button>
        <span class="muted" id="lastSync" aria-live="polite"></span>
      </div>

      <div class="panel board" role="region" aria-label="Leaderboard table">
        <table id="leaderboardTable">
          <thead>
            <tr>
              <th class="sortable" data-key="rank">
                Rank <i class="bi bi-caret-down-fill arrow"></i>
              </th>
              <th>User</th>
              <th class="sortable" data-key="catches">
                Catches <i class="bi bi-caret-down-fill arrow"></i>
              </th>
            </tr>
          </thead>
          <tbody id="leaderboardBody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
        <div id="emptyState" class="empty" hidden>
          <i class="bi bi-emoji-neutral"></i> No scores yet. Report a catch to
          get on the board!
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <span>LanternFly Quest · v0.1</span>
        <button id="resetDemo" class="btn danger small" title="Reset demo data">
          Reset
        </button>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/leaderboard.js') }}"></script>

    <!-- Initialize Google Identity (for programmatic button render) -->
    <div
      id="g_id_onload"
      data-auto_prompt="false"
      data-client_id="598997653463-svi76fvbe15v910t9c91eulju4vqasaa.apps.googleusercontent.com"
      data-callback="handleCredentialResponse">
    </div>
  </body>
</html>
